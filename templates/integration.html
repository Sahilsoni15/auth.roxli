{% extends "base.html" %}

{% block title %}Integration Guide - Roxli{% endblock %}

{% block content %}
<div class="container">
    <div class="integration-guide">
        <div class="guide-header">
            <div class="roxli-logo">
                <img src="{{ url_for('static', filename='images/logo1.png') }}" alt="Roxli" class="integration-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                <div class="roxli-logo-fallback" style="display: none;">
                    <span class="logo-r">R</span>
                    <span class="logo-o">o</span>
                    <span class="logo-x">x</span>
                    <span class="logo-l">l</span>
                    <span class="logo-i">i</span>
                </div>
            </div>
            <h1>üöÄ Roxli Authentication Integration</h1>
            <p>Add professional "Sign in with Roxli" to any website in 3 simple steps</p>
        </div>
        
        <!-- Quick Setup Steps -->
        <div class="setup-section">
            <h2>üìã Quick Setup Guide</h2>
            <div class="step-grid">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <div class="step-icon">üî•</div>
                    <h4>Firebase Setup</h4>
                    <div class="step-content">
                        <p>Create Firebase project & enable Realtime Database</p>
                        <div class="code-snippet">
                            <code>firebase-key.json</code>
                        </div>
                        <div class="step-details">
                            <ul>
                                <li>Go to Firebase Console</li>
                                <li>Create new project</li>
                                <li>Enable Realtime Database</li>
                                <li>Download service key</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="step-card">
                    <div class="step-number">2</div>
                    <div class="step-icon">‚ö°</div>
                    <h4>Install & Run</h4>
                    <div class="step-content">
                        <p>Install dependencies and start server</p>
                        <div class="code-snippet">
                            <code>pip install -r requirements.txt<br>python app.py</code>
                        </div>
                        <div class="step-details">
                            <ul>
                                <li>Clone Roxli repository</li>
                                <li>Install Python dependencies</li>
                                <li>Configure Firebase</li>
                                <li>Run on localhost:5000</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="step-card">
                    <div class="step-number">3</div>
                    <div class="step-icon">üåê</div>
                    <h4>Integrate</h4>
                    <div class="step-content">
                        <p>Add to any website with simple SDK</p>
                        <div class="code-snippet">
                            <code>&lt;script src="roxli-sdk.js"&gt;&lt;/script&gt;</code>
                        </div>
                        <div class="step-details">
                            <ul>
                                <li>Include Roxli SDK</li>
                                <li>Add login button</li>
                                <li>Handle auth events</li>
                                <li>Ready to use!</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Integration Examples -->
        <div class="integration-section">
            <h2>üíª Integration Examples</h2>
            <div class="integration-tabs">
                <button class="tab-btn active" onclick="showTab('html-basic')">HTML Website</button>
                <button class="tab-btn" onclick="showTab('react-app')">React App</button>
                <button class="tab-btn" onclick="showTab('python-flask')">Python Flask</button>
                <button class="tab-btn" onclick="showTab('nodejs')">Node.js</button>
            </div>
            
            <div id="html-basic" class="tab-content active">
                <h3>üåê HTML Website Integration</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">index.html</span>
                        <button class="copy-btn" onclick="copyCode('html-code')">üìã Copy</button>
                    </div>
                    <pre id="html-code"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;My Website with Roxli Auth&lt;/title&gt;
    &lt;style&gt;
        .roxli-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .user-card {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            max-width: 300px;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="auth-section"&gt;
        &lt;h2&gt;Please Sign In&lt;/h2&gt;
        &lt;button onclick="signInWithRoxli()" class="roxli-btn"&gt;
            üîê Sign in with Roxli
        &lt;/button&gt;
    &lt;/div&gt;
    
    &lt;div id="user-section" style="display: none;"&gt;
        &lt;div class="user-card"&gt;
            &lt;img id="user-avatar" width="60" height="60" style="border-radius: 50%;"&gt;
            &lt;h3 id="user-name"&gt;&lt;/h3&gt;
            &lt;p id="user-email"&gt;&lt;/p&gt;
            &lt;button onclick="signOut()"&gt;Sign Out&lt;/button&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script src="https://auth.roxli.in/static/js/roxli-sdk.js"&gt;&lt;/script&gt;
    &lt;script&gt;
        function signInWithRoxli() {
            RoxliAuth.signIn({
                onSuccess: function(user, token) {
                    showUserInfo(user);
                    console.log('Token:', token);
                },
                onError: function(error) {
                    alert('Login failed: ' + error);
                }
            });
        }
        
        function signOut() {
            RoxliAuth.signOut().then(() => {
                showAuthSection();
            });
        }
        
        function showUserInfo(user) {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('user-section').style.display = 'block';
            document.getElementById('user-avatar').src = user.avatar;
            document.getElementById('user-name').textContent = user.firstName + ' ' + user.lastName;
            document.getElementById('user-email').textContent = user.email;
        }
        
        function showAuthSection() {
            document.getElementById('auth-section').style.display = 'block';
            document.getElementById('user-section').style.display = 'none';
        }
        
        // Check if user is already logged in
        const user = RoxliAuth.getUser();
        if (user) {
            showUserInfo(user);
        }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                </div>
            </div>
            
            <div id="react-app" class="tab-content">
                <h3>‚öõÔ∏è React App Integration</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">App.js</span>
                        <button class="copy-btn" onclick="copyCode('react-code')">üìã Copy</button>
                    </div>
                    <pre id="react-code"><code>import React, { useState, useEffect } from 'react';

function App() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    // Load Roxli SDK
    const script = document.createElement('script');
    script.src = 'https://auth.roxli.in/static/js/roxli-sdk.js';
    document.head.appendChild(script);
    
    script.onload = () => {
      // Check if user is already logged in
      const currentUser = window.RoxliAuth.getUser();
      if (currentUser) {
        setUser(currentUser);
      }
      
      // Listen for auth state changes
      window.RoxliAuth.onAuthStateChanged((user) => {
        setUser(user);
      });
    };
  }, []);

  const signInWithRoxli = () => {
    setLoading(true);
    window.RoxliAuth.signIn({
      onSuccess: (user, token) => {
        setUser(user);
        setLoading(false);
        console.log('User signed in:', user);
        console.log('Token:', token);
      },
      onError: (error) => {
        console.error('Login failed:', error);
        setLoading(false);
      }
    });
  };

  const signOut = () => {
    window.RoxliAuth.signOut().then(() => {
      setUser(null);
    });
  };

  return (
    &lt;div className="App"&gt;
      {user ? (
        &lt;div className="user-section"&gt;
          &lt;h2&gt;Welcome, {user.firstName}!&lt;/h2&gt;
          &lt;img src={user.avatar} alt="Avatar" width="60" height="60" /&gt;
          &lt;p&gt;{user.email}&lt;/p&gt;
          &lt;button onClick={signOut}&gt;Sign Out&lt;/button&gt;
        &lt;/div&gt;
      ) : (
        &lt;div className="auth-section"&gt;
          &lt;h2&gt;Please Sign In&lt;/h2&gt;
          &lt;button 
            onClick={signInWithRoxli} 
            disabled={loading}
            style={{
              background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
              color: 'white',
              border: 'none',
              padding: '12px 24px',
              borderRadius: '8px',
              cursor: 'pointer',
              fontWeight: '600'
            }}
          &gt;
            {loading ? 'Signing in...' : 'üîê Sign in with Roxli'}
          &lt;/button&gt;
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
}

export default App;</code></pre>
                </div>
            </div>
            
            <div id="python-flask" class="tab-content">
                <h3>üêç Python Flask Integration</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">app.py</span>
                        <button class="copy-btn" onclick="copyCode('flask-code')">üìã Copy</button>
                    </div>
                    <pre id="flask-code"><code>from flask import Flask, render_template, request, jsonify, session
import requests

app = Flask(__name__)
app.secret_key = 'your-secret-key'

@app.route('/')
def index():
    user = session.get('user')
    return render_template('index.html', user=user)

@app.route('/api/verify-roxli', methods=['POST'])
def verify_roxli():
    data = request.json
    token = data.get('token')
    
    # Verify token with Roxli server
    response = requests.post('https://auth.roxli.in/api/verify', {
        'token': token
    })
    
    if response.status_code == 200:
        user_data = response.json()
        session['user'] = user_data['user']
        return jsonify({'success': True, 'user': user_data['user']})
    
    return jsonify({'error': 'Invalid token'}), 401

@app.route('/logout', methods=['POST'])
def logout():
    session.clear()
    return jsonify({'success': True})

if __name__ == '__main__':
    app.run(debug=True, port=3000)</code></pre>
                </div>
            </div>
            
            <div id="nodejs" class="tab-content">
                <h3>üü¢ Node.js Integration</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">server.js</span>
                        <button class="copy-btn" onclick="copyCode('nodejs-code')">üìã Copy</button>
                    </div>
                    <pre id="nodejs-code"><code>const express = require('express');
const axios = require('axios');
const session = require('express-session');

const app = express();
app.use(express.json());
app.use(session({
  secret: 'your-secret-key',
  resave: false,
  saveUninitialized: true
}));

app.get('/', (req, res) => {
  const user = req.session.user;
  res.send(`
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
    &lt;head&gt;&lt;title&gt;Node.js + Roxli&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
      ${user ? `
        &lt;h2&gt;Welcome ${user.firstName}!&lt;/h2&gt;
        &lt;img src="${user.avatar}" width="60" height="60"&gt;
        &lt;p&gt;${user.email}&lt;/p&gt;
        &lt;button onclick="logout()"&gt;Logout&lt;/button&gt;
      ` : `
        &lt;h2&gt;Please Sign In&lt;/h2&gt;
        &lt;button onclick="signInWithRoxli()"&gt;Sign in with Roxli&lt;/button&gt;
      `}
      
      &lt;script src="https://auth.roxli.in/static/js/roxli-sdk.js"&gt;&lt;/script&gt;
      &lt;script&gt;
        function signInWithRoxli() {
          RoxliAuth.signIn({
            onSuccess: function(user, token) {
              fetch('/verify-roxli', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token })
              }).then(() => location.reload());
            }
          });
        }
        
        function logout() {
          fetch('/logout', { method: 'POST' })
            .then(() => location.reload());
        }
      &lt;/script&gt;
    &lt;/body&gt;
    &lt;/html&gt;
  `);
});

app.post('/verify-roxli', async (req, res) => {
  try {
    const { token } = req.body;
    const response = await axios.post('https://auth.roxli.in/api/verify', { token });
    
    req.session.user = response.data.user;
    res.json({ success: true });
  } catch (error) {
    res.status(401).json({ error: 'Invalid token' });
  }
});

app.post('/logout', (req, res) => {
  req.session.destroy();
  res.json({ success: true });
});

app.listen(3000, () => {
  console.log('Server running on http://localhost:3000');
});</code></pre>
                </div>
            </div>
        </div>

        <!-- Live Demo -->
        <div class="demo-section">
            <h2>üéÆ Live Demo</h2>
            <p>Test the integration right here:</p>
            <div class="demo-container">
                <button onclick="demoSignIn()" class="roxli-signin-btn">
                    <span>üîê</span> Sign in with Roxli
                </button>
                <div id="demoResult" class="demo-result"></div>
            </div>
        </div>

        <!-- Features -->
        <div class="features-section">
            <h2>‚ú® Features Available</h2>
            <div class="features-grid">
                <div class="feature-item">
                    <span class="feature-icon">üîê</span>
                    <h4>OAuth 2.0 Based</h4>
                    <p>Secure JWT token authentication</p>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üé®</span>
                    <h4>Auto Avatars</h4>
                    <p>Beautiful generated avatars</p>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üîÑ</span>
                    <h4>Multi-Account</h4>
                    <p>Switch between accounts easily</p>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üì±</span>
                    <h4>Popup Login</h4>
                    <p>Seamless popup authentication</p>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üåê</span>
                    <h4>Cross-Platform</h4>
                    <p>Works on any website or app</p>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">‚ö°</span>
                    <h4>Fast Setup</h4>
                    <p>Ready in 3 simple steps</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.guide-header {
    text-align: center;
    margin-bottom: 50px;
    padding: 40px 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
}

.step-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-top: 30px;
}

.step-card {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    position: relative;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.step-card:hover {
    border-color: #667eea;
    transform: translateY(-5px);
}

.step-number {
    position: absolute;
    top: -15px;
    left: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
}

.step-icon {
    font-size: 2rem;
    text-align: center;
    margin-bottom: 15px;
}

.code-snippet {
    background: #f8f9fa;
    padding: 10px;
    border-radius: 6px;
    font-family: monospace;
    margin: 10px 0;
    border-left: 4px solid #667eea;
}

.step-details ul {
    list-style: none;
    padding: 0;
}

.step-details li {
    padding: 5px 0;
    position: relative;
    padding-left: 20px;
}

.step-details li::before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: #34a853;
    font-weight: bold;
}

.integration-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.tab-btn {
    padding: 10px 20px;
    border: 1px solid #ddd;
    background: white;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.3s ease;
    font-weight: 500;
}

.tab-btn.active {
    background: #667eea;
    color: white;
    border-color: #667eea;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.code-block {
    background: #f8f9fa;
    border-radius: 8px;
    overflow: hidden;
    margin: 20px 0;
    border: 1px solid #e9ecef;
}

.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    background: #e9ecef;
    border-bottom: 1px solid #dee2e6;
}

.code-title {
    font-weight: 600;
    color: #495057;
}

.copy-btn {
    background: #667eea;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

.code-block pre {
    margin: 0;
    padding: 20px;
    overflow-x: auto;
    background: #f8f9fa;
}

.code-block code {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 14px;
    line-height: 1.5;
}

.demo-container {
    text-align: center;
    padding: 30px;
    background: #f8f9fa;
    border-radius: 12px;
}

.roxli-signin-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.feature-item {
    text-align: center;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
}

.feature-item:hover {
    transform: translateY(-5px);
}

.feature-icon {
    font-size: 2rem;
    display: block;
    margin-bottom: 10px;
}

.integration-logo {
    height: 3rem;
    width: auto;
    max-width: 150px;
    object-fit: contain;
    margin-bottom: 1rem;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .container {
        padding: 0 1rem;
    }
    
    .guide-header {
        padding: 20px 15px;
        margin-bottom: 30px;
    }
    
    .guide-header h1 {
        font-size: 1.5rem;
    }
    
    .step-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .step-card {
        padding: 20px 15px;
    }
    
    .integration-tabs {
        flex-direction: column;
    }
    
    .tab-btn {
        width: 100%;
        text-align: center;
    }
    
    .code-block pre {
        padding: 15px;
        font-size: 12px;
    }
    
    .code-header {
        padding: 8px 15px;
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }
    
    .features-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .feature-item {
        padding: 15px;
    }
    
    .demo-container {
        padding: 20px 15px;
    }
    
    .integration-logo {
        height: 2.5rem;
        max-width: 120px;
    }
}

@media (max-width: 480px) {
    .guide-header h1 {
        font-size: 1.25rem;
    }
    
    .step-card {
        padding: 15px 10px;
    }
    
    .code-block pre {
        font-size: 11px;
        padding: 10px;
    }
    
    .integration-logo {
        height: 2rem;
        max-width: 100px;
    }
}
</style>

<script>
function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    document.getElementById(tabId).classList.add('active');
    event.target.classList.add('active');
}

function copyCode(elementId) {
    const code = document.getElementById(elementId).textContent;
    navigator.clipboard.writeText(code).then(() => {
        event.target.textContent = '‚úì Copied!';
        setTimeout(() => {
            event.target.textContent = 'üìã Copy';
        }, 2000);
    });
}

function demoSignIn() {
    const popup = window.open('/popup', 'roxli-auth', 'width=400,height=600,scrollbars=yes,resizable=yes');
    
    window.addEventListener('message', function(event) {
        if (event.origin !== window.location.origin) return;
        
        if (event.data.type === 'ROXLI_AUTH_SUCCESS') {
            popup.close();
            document.getElementById('demoResult').innerHTML = `
                <div class="success-message">
                    <h3>‚úÖ Login Successful!</h3>
                    <div style="display: flex; align-items: center; gap: 15px; justify-content: center; margin-top: 15px;">
                        <img src="${event.data.user.avatar}" alt="Avatar" style="width: 50px; height: 50px; border-radius: 50%;">
                        <div>
                            <p><strong>${event.data.user.firstName} ${event.data.user.lastName}</strong></p>
                            <p style="color: #666;">${event.data.user.email}</p>
                        </div>
                    </div>
                </div>
            `;
        }
    });
}
</script>
{% endblock %}